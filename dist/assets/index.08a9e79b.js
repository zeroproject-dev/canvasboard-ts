var F=Object.defineProperty;var G=(l,e,t)=>e in l?F(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var h=(l,e,t)=>(G(l,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const u of c.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&a(u)}).observe(document,{childList:!0,subtree:!0});function t(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerpolicy&&(c.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?c.credentials="include":s.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function a(s){if(s.ep)return;s.ep=!0;const c=t(s);fetch(s.href,c)}})();class Q{constructor(){h(this,"throttleTime",10)}onResizeEvent(e){window.addEventListener("resize",e)}onKeydownEvent(e){window.addEventListener("keydown",e)}onKeyupEvent(e){window.addEventListener("keyup",e)}onKeypressEvent(e){window.addEventListener("keypress",e)}onMouseDownEvent(e){i.canvas.addEventListener("mousedown",e)}onMouseMoveEvent(e){i.canvas.addEventListener("mousemove",this.throttle(e,this.throttleTime))}onMouseUpEvent(e){i.canvas.addEventListener("mouseup",e)}onMouseLeaveEvent(e){i.canvas.addEventListener("mouseleave",e)}onWheelEvent(e){i.canvas.addEventListener("wheel",e)}onTouchStartEvent(e){i.canvas.addEventListener("touchstart",e)}onTouchMoveEvent(e){i.canvas.addEventListener("touchmove",this.throttle(e,this.throttleTime))}onTouchEndEvent(e){i.canvas.addEventListener("touchend",e)}onContextMenuEvent(e){i.canvas.addEventListener("contextmenu",e)}throttle(e,t){let a=!1;return function(s){a||(e.apply(null,[s]),a=!0,setTimeout(function(){a=!1},t))}}}class r{static toScreenX(e){return(e+n.offsetX)*n.scale}static toScreenY(e){return(e+n.offsetY)*n.scale}static toWorldX(e){return e/n.scale-n.offsetX}static toWorldY(e){return e/n.scale-n.offsetY}static getWidth(){return i.canvas.clientWidth/n.scale}static getHeight(){return i.canvas.clientHeight/n.scale}}h(r,"cursorX",0),h(r,"cursorY",0),h(r,"prevCursorX",0),h(r,"prevCursorY",0),h(r,"prevTouches",[null,null]);class V{constructor(e){h(this,"properties");h(this,"type",Y.Circle);h(this,"isErased",!1);h(this,"worldCenterX");h(this,"worldCenterY");h(this,"radiusX");h(this,"radiusY");this.properties=e,this.worldCenterX=0,this.worldCenterY=0,this.radiusX=0,this.radiusY=0}startDraw(e){const t=e instanceof MouseEvent?e.pageX:e.touches[0].pageX,a=e instanceof MouseEvent?e.pageY:e.touches[0].pageY;this.properties.fill=n.fill,this.properties.initialX=t,this.properties.initialY=a}draw(e){i.clearCanvas(),i.reDraw(),i.ctx.beginPath(),i.ctx.strokeStyle=this.properties.strokeColor,i.ctx.fillStyle=this.properties.fillColor,i.ctx.lineWidth=this.properties.lineWidth*n.scale;const t=e instanceof MouseEvent?e.pageX:e.touches[0].pageX,a=e instanceof MouseEvent?e.pageY:e.touches[0].pageY;let s=(t-this.properties.initialX)/2,c=(a-this.properties.initialY)/2;if(i.isPerfectShape){const p=Math.min(Math.abs(s),Math.abs(c)),f=s<0?-1:1,g=c<0?-1:1;s=p*f,c=p*g}let u=this.properties.initialX+s,d=this.properties.initialY+c;s=Math.abs(s),c=Math.abs(c),this.worldCenterX=r.toWorldX(u),this.worldCenterY=r.toWorldY(d),this.radiusX=s/n.scale,this.radiusY=c/n.scale,i.ctx.ellipse(u,d,s,c,0,0,2*Math.PI),this.properties.fill?i.ctx.fill():i.ctx.stroke(),i.ctx.closePath()}reDraw(){i.ctx.strokeStyle=this.properties.strokeColor,i.ctx.lineWidth=this.properties.lineWidth*n.scale,i.ctx.ellipse(r.toScreenX(this.worldCenterX),r.toScreenY(this.worldCenterY),this.radiusX*n.scale,this.radiusY*n.scale,0,0,2*Math.PI),this.properties.fill?i.ctx.fill():i.ctx.stroke()}cancelDraw(){i.clearCanvas(),i.reDraw()}endDraw(){i.ctx.closePath()}isEmpty(){return this.radiusX===0&&this.radiusY===0}isCursorOnShape(e){const t=e instanceof MouseEvent?e.pageX:e.touches[0].pageX,a=e instanceof MouseEvent?e.pageY:e.touches[0].pageY,s=r.toWorldX(t),c=r.toWorldY(a),u=Math.abs(s-this.worldCenterX),d=Math.abs(c-this.worldCenterY);return u<=this.radiusX&&d<=this.radiusY&&Math.pow(u/this.radiusX,2)+Math.pow(d/this.radiusY,2)<=1}}class W{constructor(e){h(this,"line");h(this,"initialRealX");h(this,"initialRealY");h(this,"properties");h(this,"type",Y.HandDrawing);h(this,"isErased",!1);this.line=[],this.initialRealX=0,this.initialRealY=0,this.properties=e}cancelDraw(){this.line=[]}startDraw(e){i.ctx.beginPath();const t=e instanceof MouseEvent?e.pageX:e.touches[0].pageX,a=e instanceof MouseEvent?e.pageY:e.touches[0].pageY;this.properties.initialX=t,this.properties.initialY=a,this.initialRealX=r.toWorldX(t),this.initialRealY=r.toWorldY(a)}draw(e){const t=e instanceof MouseEvent?e.pageX:e.touches[0].pageX,a=e instanceof MouseEvent?e.pageY:e.touches[0].pageY;if(i.clearCanvas(),i.reDraw(),i.ctx.beginPath(),i.isPerfectShape)i.ctx.moveTo(this.properties.initialX,this.properties.initialY),i.ctx.lineTo(t,a);else{let s=[this.initialRealX,this.initialRealY];this.line.push([r.toWorldX(t),r.toWorldY(a)]);let c=this.line[0];for(let u=1;u<this.line.length;u++){let d=this.midPoint(s,c);i.ctx.quadraticCurveTo(r.toScreenX(s[0]),r.toScreenY(s[1]),r.toScreenX(d[0]),r.toScreenY(d[1])),s=this.line[u],c=this.line[u+1]}}i.ctx.stroke(),i.ctx.closePath()}midPoint(e,t){return[e[0]+(t[0]-e[0])/2,e[1]+(t[1]-e[1])/2]}reDraw(){if(this.line.length>2){i.ctx.beginPath();let e=[this.initialRealX,this.initialRealY],t=this.line[0];i.ctx.moveTo(r.toScreenX(this.initialRealX),r.toScreenY(this.initialRealY));for(let a=1;a<this.line.length;a++){let s=this.midPoint(e,t);i.ctx.quadraticCurveTo(r.toScreenX(e[0]),r.toScreenY(e[1]),r.toScreenX(s[0]),r.toScreenY(s[1])),e=this.line[a],t=this.line[a+1]}i.ctx.stroke(),i.ctx.closePath()}else{for(let e=0;e<this.line.length;e++)i.ctx.lineTo(r.toScreenX(this.line[e][0]),r.toScreenY(this.line[e][1]));i.ctx.stroke()}}endDraw(e){if(i.isPerfectShape){const t=e instanceof MouseEvent?e.pageX:e.changedTouches[0].pageX,a=e instanceof MouseEvent?e.pageY:e.changedTouches[0].pageY;this.line=[];const s=[r.toWorldX(t),r.toWorldY(a)];this.line.push([r.toWorldX(this.properties.initialX),r.toWorldY(this.properties.initialY)]),this.line.push(s)}this.line.length>2&&(this.line=this.normalizeArray(this.line)),i.ctx.closePath()}isEmpty(){return this.line.length===0}normalizeArray(e){let t=[];return t=e.filter((a,s)=>{if(s===0||s===e.length-1)return!0;const c=e[s-1];return!(c[0]===a[0]||c[1]===a[1])}),t.push([e[e.length-1][0],e[e.length-1][1]]),t}isCursorOnShape(e){const t=e instanceof MouseEvent?e.pageX:e.touches[0].pageX,a=e instanceof MouseEvent?e.pageY:e.touches[0].pageY,s=r.toWorldX(t),c=r.toWorldY(a),u=this.line;for(let d=0;d<u.length-1;d++){const p=u[d],f=u[d+1];if(this.isPointOnLine(p,f,[s,c]))return!0}return!1}isPointOnLine(e,t,a){const s=e[0],c=e[1],u=t[0],d=t[1],p=a[0],f=a[1],g=Math.sqrt((u-s)**2+(d-c)**2),y=Math.sqrt((p-s)**2+(f-c)**2),w=Math.sqrt((u-p)**2+(d-f)**2);let X=this.properties.lineWidth;return y+w>=g-X/3*n.scale&&y+w<=g+X/3*n.scale}}class _{constructor(e){h(this,"properties");h(this,"type",Y.Rectangle);h(this,"isErased",!1);h(this,"initialRealX");h(this,"initialRealY");h(this,"width");h(this,"height");this.properties=e,this.initialRealX=0,this.initialRealY=0,this.width=0,this.height=0}startDraw(e){const t=e instanceof MouseEvent?e.pageX:e.touches[0].pageX,a=e instanceof MouseEvent?e.pageY:e.touches[0].pageY;this.properties.fill=n.fill,this.properties.initialX=t,this.properties.initialY=a,this.initialRealX=r.toWorldX(t),this.initialRealY=r.toWorldY(a)}draw(e){i.clearCanvas(),i.reDraw(),i.ctx.beginPath(),i.ctx.strokeStyle=this.properties.strokeColor,i.ctx.fillStyle=this.properties.fillColor,i.ctx.lineWidth=this.properties.lineWidth*n.scale;const t=e instanceof MouseEvent?e.pageX:e.touches[0].pageX,a=e instanceof MouseEvent?e.pageY:e.touches[0].pageY;let s=t-this.properties.initialX,c=a-this.properties.initialY;if(i.isPerfectShape){const u=Math.min(Math.abs(s),Math.abs(c));let d=c<0?-1:1,p=s<0?-1:1;s=u*p,c=u*d}this.width=s/n.scale,this.height=c/n.scale,this.properties.fill?i.ctx.fillRect(this.properties.initialX,this.properties.initialY,s,c):i.ctx.rect(this.properties.initialX,this.properties.initialY,s,c),i.ctx.stroke(),i.ctx.closePath()}reDraw(){i.ctx.strokeStyle=this.properties.strokeColor,i.ctx.lineWidth=this.properties.lineWidth*n.scale,this.properties.fill?i.ctx.fillRect(r.toScreenX(this.initialRealX),r.toScreenY(this.initialRealY),this.width*n.scale,this.height*n.scale):i.ctx.rect(r.toScreenX(this.initialRealX),r.toScreenY(this.initialRealY),this.width*n.scale,this.height*n.scale),i.ctx.stroke()}cancelDraw(){i.clearCanvas(),i.reDraw()}endDraw(){i.ctx.closePath()}isEmpty(){return this.width===0&&this.height===0}isCursorOnShape(e){const t=e instanceof MouseEvent?e.pageX:e.touches[0].pageX,a=e instanceof MouseEvent?e.pageY:e.touches[0].pageY,s=r.toWorldX(t),c=r.toWorldY(a),u=this.initialRealX,d=this.initialRealY,p=this.initialRealX+this.width,f=this.initialRealY+this.height;return s>=u&&s<=p&&c>=d&&c<=f}}class T{static create(e,t={}){switch(e){case Y.HandDrawing:return new W(t);case Y.Rectangle:return new _(t);case Y.Circle:return new V(t);default:return new W(t)}}}var Y=(l=>(l.HandDrawing="HandDrawing",l.Rectangle="Rectangle",l.Circle="Circle",l))(Y||{});const R=document.getElementById("stroke_color"),P=document.getElementById("fill_color"),L=document.getElementById("canvas_color"),m=document.getElementById("size"),H=m.nextElementSibling,O=document.getElementById("drawables"),I=document.getElementById("fill"),ee=(l,e)=>{let t=l.parentElement;for(;t!==null;){if(t.tagName===e)return t;t=t.parentElement}return l},te=()=>{const l=localStorage.getItem("history");l!==null&&JSON.parse(l).forEach(a=>{const s=a.type,c=T.create(s);Object.assign(c,a),i.history.push(c)});const e=localStorage.getItem("erasedHistory");if(e!==null){const t=JSON.parse(e);i.erasedHistory=t}i.reDraw()},E=()=>{localStorage.setItem("history",JSON.stringify(i.history)),localStorage.setItem("erasedHistory",JSON.stringify(i.erasedHistory))},N={strokeColor:"#f4f4f4",fillColor:"#f4f4f4",canvasColor:"#1e1e1e",isCursorMode:!1,fill:!1,currentDrawable:"HandDrawing",lineWidth:10,offsetX:0,offsetY:0,scale:1},n=new Proxy(N,{get:(l,e)=>l[e],set:(l,e,t)=>{switch(e){case"offsetX":case"offsetY":case"scale":l[e]=t;break;case"strokeColor":l.strokeColor=t,R.value=t,i.ctx.strokeStyle=t;break;case"lineWidth":l.lineWidth=t,m.value=t,H.value=t,i.ctx.lineWidth=t;break;case"fillColor":l.fillColor=t,P.value=t,i.ctx.fillStyle=t;break;case"canvasColor":l.canvasColor=t,L.value=t,i.reDraw();break;case"fill":l.fill=t,I.checked=t;break;case"currentDrawable":l.currentDrawable=t;break;case"isCursorMode":l.isCursorMode=t,i.isCursorMode=t;break}return se(),!0}}),ie=()=>{i.ctx.lineJoin="round",i.ctx.lineCap="round";const l=localStorage.getItem("config");if(l!==null){const e=JSON.parse(l);Object.assign(n,e)}},se=()=>{localStorage.setItem("config",JSON.stringify(N))},k=()=>{O.childNodes.forEach(l=>{if(l.nodeType===Node.ELEMENT_NODE){const e=l;e.classList.toggle("selected_draw",e.dataset.type===n.currentDrawable)}})},re=()=>{m.addEventListener("input",e=>{const t=e.target;n.lineWidth=Number(t.value)}),H.addEventListener("input",e=>{const t=e.target;if(Number(t.value)>50){n.lineWidth=50;return}else if(Number(t.value)<1){n.lineWidth=1;return}n.lineWidth=Number(t.value)}),R.addEventListener("change",({target:e})=>{n.strokeColor=e.value}),P.addEventListener("change",({target:e})=>{n.fillColor=e.value}),L.addEventListener("change",({target:e})=>{n.canvasColor=e.value}),I.addEventListener("change",({target:e})=>{n.fill=e.checked}),document.getElementById("clear").addEventListener("click",()=>{i.clearBoard()}),document.getElementById("reset").addEventListener("click",()=>{Object.assign(n,{strokeColor:"#f4f4f4",fillColor:"#f4f4f4",canvasColor:"#1e1e1e",lineWidth:10,fill:!1,currentDrawable:"HandDrawing",offsetX:0,offsetY:0,scale:1}),i.reDraw()}),document.getElementById("undo").addEventListener("click",()=>{i.undo()});const l=document.getElementById("download");l.addEventListener("click",()=>{l.setAttribute("download","image.png"),l.setAttribute("href",i.canvas.toDataURL("image/png"))}),O.addEventListener("click",e=>{let t=e.target;t.tagName!=="BUTTON"&&(t=ee(t,"BUTTON"));const a=t.dataset.type;if(a===void 0)return;let s=a==="Cursor";i.isCursorMode=s,n.isCursorMode=s,n.currentDrawable=a,k()}),window.addEventListener("load",()=>{ie(),te(),k()})},o=class extends Q{constructor(){super();h(this,"isDrawing");h(this,"isDragging");h(this,"timer",0);h(this,"currentDraw",null);o.canvas=document.getElementById("canvas"),o.ctx=o.canvas.getContext("2d"),o.canvas.width=document.body.clientWidth,o.canvas.height=document.body.clientHeight,this.isDrawing=!1,this.isDragging=!1,this.createDrawable(),o.clearCanvas()}initializeEvents(){this.onResizeEvent(this.onResize.bind(this)),this.onMouseDownEvent(this.onMouseDown.bind(this)),this.onMouseMoveEvent(this.onMouseMove.bind(this)),this.onMouseUpEvent(this.onMouseUp.bind(this)),this.onMouseLeaveEvent(this.onMouseUp.bind(this)),this.onContextMenuEvent(this.onContextMenu.bind(this)),this.onWheelEvent(this.onMouseWheel.bind(this)),this.onTouchStartEvent(this.onTouchStart.bind(this)),this.onTouchMoveEvent(this.onTouchMove.bind(this)),this.onTouchEndEvent(this.onTouchEnd.bind(this)),this.onKeydownEvent(this.onKeyDown.bind(this)),re()}onContextMenu(t){t.preventDefault()}onResize(){o.canvas.width=document.body.clientWidth,o.canvas.height=document.body.clientHeight,o.clearCanvas(),o.reDraw()}static reDraw(){o.history.length!=0&&(o.clearCanvas(),o.history.forEach(t=>{t.isErased||(o.ctx.strokeStyle=t.properties.strokeColor,o.ctx.fillStyle=t.properties.fillColor,o.ctx.lineWidth=t.properties.lineWidth*n.scale,o.ctx.moveTo(t.properties.initialX,t.properties.initialY),o.ctx.beginPath(),o.ctx.lineCap="round",t.reDraw(),o.ctx.closePath())}),o.ctx.strokeStyle=n.strokeColor,o.ctx.lineWidth=n.lineWidth*n.scale)}startDraw(t){var a;if(o.isCursorMode){if(t instanceof MouseEvent&&t.button!==0)return;let s=this.checkCursorOnShape(t);s!==-1&&(o.history[s].isErased=!0,o.erasedHistory.push({index:s,countHistory:o.history.length}),o.clearCanvas(),o.reDraw(),E());return}this.isDrawing&&(o.ctx.strokeStyle=n.strokeColor,o.ctx.fillStyle=n.fillColor,o.ctx.lineWidth=n.lineWidth*n.scale,this.createDrawable(),(a=this.currentDraw)==null||a.startDraw(t))}draw(t){var a;o.isCursorMode||this.isDrawing&&(clearTimeout(this.timer),o.isPerfectShape||(this.timer=setTimeout(()=>{var s;o.isPerfectShape=!0,(s=this.currentDraw)==null||s.draw(t)},600)),(a=this.currentDraw)==null||a.draw(t))}endDraw(t){var a,s;if(o.isCursorMode){this.isDragging=!1;return}this.isDrawing&&((a=this.currentDraw)==null||a.endDraw(t),(s=this.currentDraw)!=null&&s.isEmpty()||(o.history.push(this.currentDraw),E())),this.isDrawing=!1,this.isDragging=!1,o.isPerfectShape=!1,clearTimeout(this.timer)}onMouseDown(t){t.preventDefault(),this.isDrawing=t.button==0&&!o.isCursorMode,this.isDragging=t.button==1,r.cursorX=t.pageX,r.cursorY=t.pageY,r.prevCursorX=t.pageX,r.prevCursorY=t.pageY,this.startDraw(t)}checkCursorOnShape(t){let a=-1;for(let s=o.history.length-1;s>=0;s--)if(o.history[s].isCursorOnShape(t)){a=s;break}return a}onMouseMove(t){r.cursorX=t.pageX,r.cursorY=t.pageY,this.draw(t),this.isDragging&&(n.offsetX+=(r.cursorX-r.prevCursorX)/n.scale,n.offsetY+=(r.cursorY-r.prevCursorY)/n.scale,o.reDraw()),r.prevCursorX=r.cursorX,r.prevCursorY=r.cursorY}onMouseUp(t){this.endDraw(t)}onMouseWheel(t){var w;if(this.isDrawing){(w=this.currentDraw)==null||w.cancelDraw(),this.createDrawable(),this.isDrawing=!1,this.isDragging=!1;return}const s=-t.deltaY/500,c=n.scale*(1+s);if(c<.1||c>10)return;n.scale=c;var u=t.pageX/o.canvas.clientWidth,d=t.pageY/o.canvas.clientHeight;const p=r.getWidth()*s,f=r.getHeight()*s,g=p*u,y=f*d;n.offsetX-=g,n.offsetY-=y,o.reDraw()}onTouchStart(t){this.isDrawing=t.touches.length==1,this.isDragging=t.touches.length>=2,r.prevTouches[0]=t.touches[0],r.prevTouches[1]=t.touches[1],this.startDraw(t)}onTouchMove(t){var g,y,w;if(r.prevTouches[0]===null||r.prevTouches[1]===null)return;const a=t.touches[0].pageX,s=t.touches[0].pageY,c=r.prevTouches[0].pageX,u=r.prevTouches[0].pageY;if(this.draw(t),this.isDragging){if(this.isDrawing){(g=this.currentDraw)==null||g.cancelDraw(),this.createDrawable(),this.isDrawing=!1,this.isDragging=!1;return}t.preventDefault();const X=t.touches[1].pageX,x=t.touches[1].pageY,C=(y=r.prevTouches[1])==null?void 0:y.pageX,v=(w=r.prevTouches[1])==null?void 0:w.pageY,M=(a+X)/2,S=(s+x)/2,z=(c+C)/2,A=(u+v)/2,B=Math.sqrt(Math.pow(a-X,2)+Math.pow(s-x,2)),U=Math.sqrt(Math.pow(c-C,2)+Math.pow(u-v,2));var d=B/U;const D=n.scale*d;if(D<.1||D>10)return;n.scale=D;const b=1-d,q=M-z,K=S-A;n.offsetX+=q/n.scale,n.offsetY+=K/n.scale;var p=M/o.canvas.clientWidth,f=S/o.canvas.clientHeight;const J=r.getWidth()*b,$=r.getHeight()*b,j=J*p,Z=$*f;n.offsetX+=j,n.offsetY+=Z,o.reDraw()}r.prevTouches[0]=t.touches[0],r.prevTouches[1]=t.touches[1]}onTouchEnd(t){this.endDraw(t),r.prevTouches[0]=null,r.prevTouches[1]=null}onKeyDown(t){t.ctrlKey&&(t.key===""||t.key==="z")&&o.undo()}static undo(){if(o.history.length!=0){if(o.clearCanvas(),o.erasedHistory.length>0){let t=o.erasedHistory.length-1;o.erasedHistory[t].countHistory===o.history.length?(o.history[o.erasedHistory[t].index].isErased=!1,o.erasedHistory.pop()):o.history.pop()}else o.history.pop();E(),o.reDraw()}}static clearBoard(){o.clearCanvas(),o.history=[],E()}createDrawable(){this.currentDraw=T.create(n.currentDrawable,{strokeColor:n.strokeColor,lineWidth:n.lineWidth,fillColor:n.fillColor})}static clearCanvas(t=null){o.ctx.fillStyle=n.canvasColor,t===null?o.ctx.fillRect(0,0,document.body.clientWidth,document.body.clientHeight):o.ctx.fillRect(t.prevX,t.prevY,t.x,t.y),o.ctx.fillStyle=n.fillColor}};let i=o;h(i,"canvas"),h(i,"ctx"),h(i,"isCursorMode",!1),h(i,"isPerfectShape",!1),h(i,"history",[]),h(i,"erasedHistory",[]);const ne=new i;ne.initializeEvents();
